# プロジェクト設計ドキュメント

（課題全体像・イシュー・変数定義）

## 1. プロジェクト概要

本プロジェクトは、**Statcastデータを用いて「長打が再現される打球状態とスイング条件」を特定する**ことを目的とする。分析は以下の2層構造で進める。

* **第1層**: 打球結果データのみを用いて「長打価値が高い打球状態（EV×LA帯域）」を定義する
* **第2層**: スイング・バットトラッキング指標を用いて「第1層で定義した高価値帯域に到達する条件」を説明する

本リポジトリは、**第1層の安定的な実装と、第2層への接続性確保**を最優先とする。

---

## 2. 本課題のイシュー定義（最重要）

### 中心イシュー

> **「長打は“結果”ではなく“状態”として再現可能か？」**

ここでいう状態とは:

* 打球速度（EV）
* 打球角度（LA）
* （将来的には）打球方向

### なぜ xwOBA をそのまま使わないのか

* xwOBA は EV・LA を説明変数に含む ML 指標
* 本研究で同じ変数を使うと **循環参照**が起きる
* 単打の価値が混入し **「長打を狙う研究」として論点がぼやける**

→ **長打に特化した独自スコアと状態定義を採用する**

---

## 3. 分析全体の流れ（鳥瞰）

```
[Statcast 生データ]
        ↓
[BIP抽出（EV, LAあり）]
        ↓
[長打スコア V を定義]
        ↓
[EV×LA 空間で E[V] を集計]
        ↓
[高価値帯域（大谷Barrel）を定義]
        ↓
[各打球にラベル y を付与]
        ↓
[第2層：スイング指標で y を説明]
```

---

## 4. 第1層の役割と制約

### 役割

* 目的変数 `y` を恣意性なく定義する
* 誰が見ても納得できる状態マップを作る
* 第2層の説明可能性を最大化する

### 制約

* 機械学習は使用しない
* xwOBAを目的変数にしない
* 「価値」ではなく「状態の区別」に集中する

---

## 5. 長打スコア V の定義

### 結果の数値化

| 結果   | bases |
| ------ | ----- |
| アウト | 0     |
| 単打   | 1     |
| 二塁打 | 2     |
| 三塁打 | 3     |
| 本塁打 | 4     |

### 長打スコア

```
V = max(bases - 1, 0)
```

### 解釈

* 単打は 0（評価しない）
* 二塁打以上のみ正の値
* Vは「得点価値」ではなく、長打状態を識別するための補助スコア

---

## 6. 高価値打球状態（第1層アウトプット）

* EV×LA をビン分割
* 各セルで `E[V]` を計算
* 上位 q%（初期値 15%）を **「高価値長打状態（大谷Barrel）」** と定義

この定義は:

* MLB全体のBarrel定義とは独立
* 選手固有の最適状態を捉えることを目的とする

---

## 7. 第2層との接続（なぜこれでいいか）

* 第2層では **y = 高価値帯域到達 여부** を説明する
* y は「結果」ではなく「状態到達」
* 運・守備・球場の影響を最小化でき、再現性を議論できる構造になる

---

## 8. 主要変数一覧（第1層）

| 変数名          | 説明            | 使用層    |
| --------------- | --------------- | --------- |
| launch_speed    | 打球初速（mph） | 第1層     |
| launch_angle    | 打球角度（deg） | 第1層     |
| events          | 打球結果        | 第1層     |
| bases           | 結果の数値化    | 第1層     |
| V               | 長打スコア      | 第1層     |
| y               | 高価値帯域ラベル | 第1・2層 |

---

## 9. このドキュメントの役割

* 分析が迷走したときの判断基準
* 「なぜこの設計か？」への即答材料
* Cursor補完の前提文脈
* 発表・評価時のストーリー骨格

---

## 最重要メモ（自分用）

> この研究の価値は **「長打を“再現可能な状態”として定義したこと」** にある。モデル精度ではない。


